<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©æŠ¼ã—ã‚¯ã‚¤ã‚ºãƒãƒˆãƒ« - ã¿ã‚“ãªã§æ­£è§£ãƒãƒ£ãƒ³ã‚¹</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #333;
}

.container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 800px;
    width: 90%;
    transition: all 0.3s ease;
}

h1 {
    text-align: center;
    color: #764ba2;
    margin-bottom: 30px;
    font-size: 2.5em;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}

.screen {
    display: none;
    animation: fadeIn 0.5s ease;
}

.screen.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦é¸æŠç”»é¢ */
.mode-selection {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px 0;
}

.mode-card {
    background: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.mode-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.mode-card h3 {
    color: #764ba2;
    margin-bottom: 10px;
}

/* ãƒ«ãƒ¼ãƒ ç®¡ç† */
.room-controls {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
}

.room-id {
    font-size: 2em;
    font-weight: bold;
    color: #764ba2;
    text-align: center;
    margin: 20px 0;
    padding: 10px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.online-players {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin: 20px 0;
    max-height: 300px;
    overflow-y: auto;
}

.online-player {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin: 5px 0;
    background: #f8f9fa;
    border-radius: 5px;
}

.online-player.ready {
    background: #d4edda;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ²ç”»é¢ */
.player-input {
    margin-bottom: 15px;
}

.player-input input {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s;
}

.player-input input:focus {
    outline: none;
    border-color: #764ba2;
}

.player-list {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
    max-height: 200px;
    overflow-y: auto;
}

.player-item {
    background: white;
    padding: 10px;
    margin: 5px 0;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ */
.category-selection {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.category-item {
    background: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    border: 3px solid transparent;
}

.category-item:hover {
    border-color: #764ba2;
    transform: scale(1.05);
}

.category-item.selected {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-color: #764ba2;
}

/* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
.btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 25px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-block;
    margin: 10px 5px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

.btn:active {
    transform: translateY(0);
}

.btn-danger {
    background: linear-gradient(135deg, #f093fb, #f5576c);
}

.btn-success {
    background: linear-gradient(135deg, #11998e, #38ef7d);
}

.btn-secondary {
    background: linear-gradient(135deg, #6c757d, #495057);
}

/* éŸ³å£°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
.sound-control {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    padding: 10px;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
}

.sound-control:hover {
    transform: scale(1.1);
}

/* ã‚¯ã‚¤ã‚ºç”»é¢ */
.quiz-header {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    text-align: center;
}

.question-number {
    font-size: 1.2em;
    color: #764ba2;
    margin-bottom: 10px;
}

.timer {
    font-size: 2em;
    font-weight: bold;
    color: #f5576c;
    margin-bottom: 10px;
}

.game-mode-info {
    font-size: 1em;
    color: #11998e;
    font-weight: bold;
    background: rgba(17, 153, 142, 0.1);
    padding: 8px;
    border-radius: 5px;
    margin-top: 10px;
}

.question {
    font-size: 1.4em;
    margin-bottom: 30px;
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
}

.choices {
    display: grid;
    gap: 15px;
    margin-bottom: 30px;
}

.choice {
    background: white;
    border: 3px solid #ddd;
    padding: 20px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
    font-size: 1.1em;
    position: relative;
}

.choice:hover {
    border-color: #764ba2;
    transform: scale(1.02);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.choice.correct {
    background: #38ef7d;
    color: white;
    border-color: #11998e;
}

.choice.incorrect {
    background: #f5576c;
    color: white;
    border-color: #f093fb;
}

.choice.disabled {
    opacity: 0.6;
    cursor: not-allowed;
    pointer-events: none;
}

/* å›ç­”ãƒ­ã‚° */
.answer-log {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
}

.answer-log h4 {
    color: #764ba2;
    margin-bottom: 15px;
    text-align: center;
}

.answer-item {
    background: white;
    padding: 10px 15px;
    margin: 8px 0;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    border-left: 4px solid transparent;
}

.answer-item.correct {
    border-left-color: #38ef7d;
    background: #d4edda;
}

.answer-item.incorrect {
    border-left-color: #f5576c;
    background: #f8d7da;
}

.answer-order {
    font-weight: bold;
    color: #764ba2;
    margin-right: 10px;
}

.answer-points {
    font-weight: bold;
    color: #11998e;
}

/* çµæœç”»é¢ */
.results {
    background: #f8f9fa;
    padding: 30px;
    border-radius: 15px;
}

.rank-item {
    background: white;
    padding: 20px;
    margin: 15px 0;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s;
}

.rank-item:hover {
    transform: translateX(10px);
}

.rank-1 {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    font-size: 1.3em;
    font-weight: bold;
}

.rank-2 {
    background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
}

.rank-3 {
    background: linear-gradient(135deg, #cd7f32, #e6a85c);
}

.rank-number {
    font-size: 2em;
    font-weight: bold;
    color: #764ba2;
    margin-right: 20px;
}

/* å•é¡Œä½œæˆç”»é¢ */
.question-form {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #764ba2;
}

.form-group input, .form-group textarea, .form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s;
}

.form-group textarea {
    resize: vertical;
    min-height: 80px;
}

.form-group input:focus, .form-group textarea:focus, .form-group select:focus {
    outline: none;
    border-color: #764ba2;
}

.question-list {
    max-height: 300px;
    overflow-y: auto;
}

.question-item {
    background: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.center {
    text-align: center;
}

/* æ¥ç¶šçŠ¶æ…‹è¡¨ç¤º */
.connection-status {
    position: fixed;
    top: 20px;
    left: 20px;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: bold;
    z-index: 1000;
}

.connection-status.connected {
    background: #d4edda;
    color: #155724;
}

.connection-status.disconnected {
    background: #f8d7da;
    color: #721c24;
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
@keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0,0,0);
    }
    40%, 43% {
        transform: translate3d(0, -30px, 0);
    }
    70% {
        transform: translate3d(0, -15px, 0);
    }
    90% {
        transform: translate3d(0, -4px, 0);
    }
}

.choice.selected {
    animation: bounce 0.8s ease;
}

/* ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾…æ©Ÿç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.room-info {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    text-align: center;
    font-size: 1.2em;
    font-weight: bold;
}

.player-section {
    margin: 20px 0;
}

.player-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin: 5px 0;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #ddd;
}

.player-item.ready {
    border-left-color: #28a745;
    background: #d4edda;
}

.ready-status {
    font-size: 0.9em;
    color: #6c757d;
}

.player-item.ready .ready-status {
    color: #155724;
    font-weight: bold;
}

.you-label {
    background: #007bff;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8em;
}

.host-label {
    background: #fd7e14;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8em;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 600px) {
    .container {
        padding: 20px;
    }
    
    h1 {
        font-size: 2em;
    }
    
    .question {
        font-size: 1.2em;
    }

    .mode-selection {
        grid-template-columns: 1fr;
    }
    
    .category-selection {
        grid-template-columns: 1fr 1fr;
    }
    
    .rank-item {
        flex-direction: column;
        text-align: center;
    }
    
    .rank-number {
        margin-bottom: 10px;
        margin-right: 0;
    }
}
    </style>
</head>
<body>
    <!-- éŸ³å£°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div class="sound-control" onclick="toggleSound()" title="éŸ³å£°ON/OFF">
        <span id="soundIcon">ğŸ”Š</span>
    </div>

    <!-- æ¥ç¶šçŠ¶æ…‹ -->
    <div class="connection-status disconnected" id="connectionStatus" style="display: none;">
        ã‚ªãƒ•ãƒ©ã‚¤ãƒ³
    </div>

    <div class="container">
        <h1>ğŸ¯ æ—©æŠ¼ã—ã‚¯ã‚¤ã‚ºãƒãƒˆãƒ«</h1>

        <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
        <div id="homeScreen" class="screen active">
            <div class="mode-selection">
                <div class="mode-card" onclick="startLocalGame()">
                    <h3>ğŸ  ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦</h3>
                    <p>åŒã˜ç«¯æœ«ã§å¯¾æˆ¦</p>
                </div>
                <div class="mode-card" onclick="showOnlineMenu()">
                    <h3>ğŸŒ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦</h3>
                    <p>é›¢ã‚ŒãŸå ´æ‰€ã‹ã‚‰å¯¾æˆ¦</p>
                </div>
            </div>
            <div class="center">
                <button class="btn" onclick="showQuestionCreator()">å•é¡Œã‚’ä½œæˆã™ã‚‹</button>
            </div>
        </div>

        <!-- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div id="onlineMenuScreen" class="screen">
            <h2>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦</h2>
            <div class="room-controls">
                <div class="form-group">
                    <label>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label>
                    <input type="text" id="onlinePlayerName" placeholder="ã‚ãªãŸã®åå‰ã‚’å…¥åŠ›">
                </div>
                <div class="center">
                    <button class="btn btn-success" onclick="createRoom()">ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆ</button>
                    <button class="btn" onclick="showJoinRoom()">ãƒ«ãƒ¼ãƒ ã«å‚åŠ </button>
                    <button class="btn btn-danger" onclick="showHome()">æˆ»ã‚‹</button>
                </div>
            </div>
        </div>

        <!-- ãƒ«ãƒ¼ãƒ å‚åŠ ç”»é¢ -->
        <div id="joinRoomScreen" class="screen">
            <h2>ãƒ«ãƒ¼ãƒ ã«å‚åŠ </h2>
            <div class="form-group">
                <label>ãƒ«ãƒ¼ãƒ ID</label>
                <input type="text" id="roomIdInput" placeholder="ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›">
            </div>
            <div class="center">
                <button class="btn btn-success" onclick="joinRoom()">å‚åŠ </button>
                <button class="btn btn-danger" onclick="showOnlineMenu()">æˆ»ã‚‹</button>
            </div>
        </div>

        <!-- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾…æ©Ÿå®¤ -->
<div id="onlineWaitingScreen" class="screen">
    <div class="container">
        <h2>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾…æ©Ÿå®¤</h2>
        <div id="roomIdDisplay" class="room-info"></div>
        
        <div class="player-section">
            <h3>å‚åŠ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
            <div id="onlinePlayerList"></div>
        </div>
        
        <div class="button-group">
            <button class="btn btn-primary" onclick="togglePlayerReady()">æº–å‚™å®Œäº†/è§£é™¤</button>
            <button id="startOnlineGameBtn" class="btn btn-success" onclick="startOnlineGame()" style="display: none;">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
            <button class="btn btn-secondary" onclick="leaveOnlineRoom()">ãƒ«ãƒ¼ãƒ é€€å‡º</button>
        </div>
    </div>
</div>

        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ²ç”»é¢ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ -->
        <div id="playerScreen" class="screen">
            <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ²</h2>
            <div class="player-input">
                <input type="text" id="playerName" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›" onkeypress="if(event.key==='Enter')addPlayer()">
            </div>
            <button class="btn btn-success" onclick="addPlayer()">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ </button>
            
            <div class="player-list">
                <h3>å‚åŠ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
                <div id="playerList"></div>
            </div>
            
            <div class="center">
                <button class="btn" onclick="showCategorySelection()" id="startBtn" style="display:none;">æ¬¡ã¸</button>
                <button class="btn btn-danger" onclick="showHome()">æˆ»ã‚‹</button>
            </div>
        </div>

        <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠç”»é¢ -->
        <div id="categoryScreen" class="screen">
            <h2>ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ</h2>
            <p>å‡ºé¡Œã™ã‚‹ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</p>
            <div class="category-selection" id="categorySelection">
                <div class="category-item" data-category="general" onclick="toggleCategory('general')">
                    <h4>ğŸ“š ä¸€èˆ¬å¸¸è­˜</h4>
                </div>
                <div class="category-item" data-category="geography" onclick="toggleCategory('geography')">
                    <h4>ğŸŒ åœ°ç†</h4>
                </div>
                <div class="category-item" data-category="history" onclick="toggleCategory('history')">
                    <h4>ğŸ“œ æ­´å²</h4>
                </div>
                <div class="category-item" data-category="science" onclick="toggleCategory('science')">
                    <h4>ğŸ”¬ ç§‘å­¦</h4>
                </div>
                <div class="category-item" data-category="sports" onclick="toggleCategory('sports')">
                    <h4>âš½ ã‚¹ãƒãƒ¼ãƒ„</h4>
                </div>
                <div class="category-item" data-category="entertainment" onclick="toggleCategory('entertainment')">
                    <h4>ğŸ¬ ã‚¨ãƒ³ã‚¿ãƒ¡</h4>
                </div>
                <div class="category-item" data-category="custom" onclick="toggleCategory('custom')">
                    <h4>âœï¸ ã‚«ã‚¹ã‚¿ãƒ </h4>
                </div>
            </div>
            <div class="center">
                <button class="btn btn-success" onclick="startGameWithCategories()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
                <button class="btn btn-danger" onclick="showPlayerRegistration()">æˆ»ã‚‹</button>
            </div>
        </div>

        <!-- ã‚¯ã‚¤ã‚ºç”»é¢ -->
        <div id="quizScreen" class="screen">
            <div class="quiz-header">
                <div class="question-number" id="questionNumber">ç¬¬1å• / 6å•</div>
                <div class="timer" id="timer">15</div>
                <div class="game-mode-info">æ­£è§£è€…å…¨å“¡ã«ãƒã‚¤ãƒ³ãƒˆï¼æ—©ã„é †ã«ã‚ˆã‚Šå¤šãã®ãƒã‚¤ãƒ³ãƒˆï¼</div>
            </div>
            
            <div class="question" id="questionText">å•é¡Œæ–‡ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
            
            <div class="choices" id="choices">
                <div class="choice" onclick="selectChoice(0)">é¸æŠè‚¢1</div>
                <div class="choice" onclick="selectChoice(1)">é¸æŠè‚¢2</div>
                <div class="choice" onclick="selectChoice(2)">é¸æŠè‚¢3</div>
            </div>
            
            <!-- å›ç­”è€…è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="answer-log" id="answerLog">
                <h4>å›ç­”çŠ¶æ³</h4>
                <div id="answerList"></div>
            </div>
        </div>

        <!-- çµæœç”»é¢ -->
        <div id="resultScreen" class="screen">
            <h2>ğŸ† æœ€çµ‚çµæœ</h2>
            <div class="results" id="results"></div>
            <div class="center">
                <button class="btn" onclick="resetGame()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
                <button class="btn btn-danger" onclick="showHome()">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
            </div>
        </div>

        <!-- å•é¡Œä½œæˆç”»é¢ -->
        <div id="questionCreatorScreen" class="screen">
            <h2>å•é¡Œä½œæˆ</h2>
            <div class="question-form">
                <div class="form-group">
                    <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                    <select id="questionCategory">
                        <option value="general">ä¸€èˆ¬å¸¸è­˜</option>
                        <option value="geography">åœ°ç†</option>
                        <option value="history">æ­´å²</option>
                        <option value="science">ç§‘å­¦</option>
                        <option value="sports">ã‚¹ãƒãƒ¼ãƒ„</option>
                        <option value="entertainment">ã‚¨ãƒ³ã‚¿ãƒ¡</option>
                        <option value="custom">ã‚«ã‚¹ã‚¿ãƒ </option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å•é¡Œæ–‡</label>
                    <textarea id="newQuestion" placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                </div>
                <div class="form-group">
                    <label>é¸æŠè‚¢1</label>
                    <input type="text" id="choice1" placeholder="é¸æŠè‚¢1ã‚’å…¥åŠ›">
                </div>
                <div class="form-group">
                    <label>é¸æŠè‚¢2</label>
                    <input type="text" id="choice2" placeholder="é¸æŠè‚¢2ã‚’å…¥åŠ›">
                </div>
                <div class="form-group">
                    <label>é¸æŠè‚¢3</label>
                    <input type="text" id="choice3" placeholder="é¸æŠè‚¢3ã‚’å…¥åŠ›">
                </div>
                <div class="form-group">
                    <label>æ­£è§£ã®é¸æŠè‚¢ç•ªå·ï¼ˆ1-3ï¼‰</label>
                    <input type="number" id="correctAnswer" min="1" max="3" placeholder="1">
                </div>
                <button class="btn btn-success" onclick="addQuestion()">å•é¡Œã‚’è¿½åŠ </button>
            </div>
            
            <div class="question-list">
                <h3>ç™»éŒ²æ¸ˆã¿ã®å•é¡Œ</h3>
                <div id="questionList"></div>
            </div>
            
            <div class="center">
                <button class="btn btn-danger" onclick="showHome()">æˆ»ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
// ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç†
let gameState = {
    mode: 'local', // local or online
    players: [],
    currentQuestion: 0,
    questions: [],
    timer: null,
    timeLeft: 15,
    scores: {},
    selectedCategories: [],
    soundEnabled: true,
    currentAnswers: [], // ç¾åœ¨ã®å•é¡Œã®å›ç­”çŠ¶æ³
    onlineState: {
        roomId: null,
        playerId: null,
        isHost: false,
        ws: null
    }
};

// éŸ³å£°ç®¡ç†
const sounds = {
    correct: new Audio('data:audio/wav;base64,UklGRi4CAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQoCAAC5wMTBxL6/v7fAvsHAv7+/v7+/v7+/v7+/v8C7wb3Bvb6/vL+8v73AvMC+vb+9vr2/vL69wLy/vL+9wL6/vr6/wL/AvsG/wMDAwMDBwcDAwcDBwcHCwcLBw8LDw8PDw8TExMTFxMXFxcXGxsbGx8bHx8fHyMfIyMnIycnJycnKysrKy8vLy8zMzMzNzM3Nzs3Ozs7Ozs/O0M/Q0M/Q0NDR0dHR0tHR0tLS0tLS09PT09TU1NTU1dTU1dXV1dYAAAC5wMTBxL6/v7fAvsHAv7+/v7+/v7+/v7+/v8C7wb3Bvb6/vL+8v73AvMC+vb+9vr2/vL69wLy/vL+9wL6/vr6/wL/AvsG/wMDAwMDBwcDAwcDBwcHCwcLBw8LDw8PDw8TExMTFxMXFxcXGxsbGx8bHx8fHyMfIyMnIycnJycnKysrKy8vLy8zMzMzNzM3Nzs3Ozs7Ozs/O0M/Q0M/Q0NDR0dHR0tHR0tLS0tLS09PT09TU1NTU1dTU1dXV1dY='),
    incorrect: new Audio('data:audio/wav;base64,UklGRhwCAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YfgBAADPz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Qz9DP0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0'),
    start: new Audio('data:audio/wav;base64,UklGRhwDAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YfgCAABhYWBhYGFgYWBhYGFgYWBgYGBhYGFgYWBhYGFgYWBhYGFgYWBhYGFgYWBhYGFgYWBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBg')
};

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å•é¡Œï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ï¼‰
const defaultQuestions = {
    general: [
        {
            question: "æ—¥æœ¬ã®é¦–éƒ½ã¯ã©ã“ã§ã™ã‹ï¼Ÿ",
            choices: ["å¤§é˜ª", "æ±äº¬", "äº¬éƒ½"],
            correct: 1,
            category: "general"
        },
        {
            question: "æ—¥æœ¬ã®é€šè²¨å˜ä½ã¯ï¼Ÿ",
            choices: ["ã‚¦ã‚©ãƒ³", "å…ƒ", "å††"],
            correct: 2,
            category: "general"
        },
        {
            question: "æ—¥æœ¬ã®å›½èŠ±ã¯ï¼Ÿ",
            choices: ["æ¡œ", "èŠ", "æ¢…"],
            correct: 0,
            category: "general"
        }
    ],
    geography: [
        {
            question: "å¯Œå£«å±±ã®é«˜ã•ã¯ï¼Ÿ",
            choices: ["3,776m", "3,676m", "3,876m"],
            correct: 0,
            category: "geography"
        },
        {
            question: "æ—¥æœ¬ã§ä¸€ç•ªå¤§ããªæ¹–ã¯ï¼Ÿ",
            choices: ["éœãƒ¶æµ¦", "çµç¶æ¹–", "æ´çˆºæ¹–"],
            correct: 1,
            category: "geography"
        },
        {
            question: "æ—¥æœ¬ã§ä¸€ç•ªé•·ã„å·ã¯ï¼Ÿ",
            choices: ["åˆ©æ ¹å·", "ä¿¡æ¿ƒå·", "çŸ³ç‹©å·"],
            correct: 1,
            category: "geography"
        }
    ],
    history: [
        {
            question: "éŒå€‰å¹•åºœã‚’é–‹ã„ãŸã®ã¯èª°ï¼Ÿ",
            choices: ["æºé ¼æœ", "è¶³åˆ©å°Šæ°", "å¾³å·å®¶åº·"],
            correct: 0,
            category: "history"
        },
        {
            question: "æ˜æ²»ç¶­æ–°ã¯ä½•å¹´ï¼Ÿ",
            choices: ["1868å¹´", "1858å¹´", "1878å¹´"],
            correct: 0,
            category: "history"
        },
        {
            question: "ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ¦ãŒçµ‚ã‚ã£ãŸå¹´ã¯ï¼Ÿ",
            choices: ["1944å¹´", "1945å¹´", "1946å¹´"],
            correct: 1,
            category: "history"
        }
    ],
    science: [
        {
            question: "æ°´ã®åŒ–å­¦å¼ã¯ï¼Ÿ",
            choices: ["CO2", "H2O", "O2"],
            correct: 1,
            category: "science"
        },
        {
            question: "å…‰ã®é€Ÿåº¦ã¯ç´„ï¼Ÿ",
            choices: ["30ä¸‡km/ç§’", "3ä¸‡km/ç§’", "300ä¸‡km/ç§’"],
            correct: 0,
            category: "science"
        },
        {
            question: "åœ°çƒã‹ã‚‰å¤ªé™½ã¾ã§ã®è·é›¢ã¯ç´„ï¼Ÿ",
            choices: ["1å„„5000ä¸‡km", "1000ä¸‡km", "10å„„km"],
            correct: 0,
            category: "science"
        }
    ],
    sports: [
        {
            question: "æ±äº¬ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯2020ã®é–‹å‚¬å¹´ã¯ï¼Ÿ",
            choices: ["2020å¹´", "2021å¹´", "2022å¹´"],
            correct: 1,
            category: "sports"
        },
        {
            question: "ã‚µãƒƒã‚«ãƒ¼ã®ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚«ãƒƒãƒ—ã¯ä½•å¹´ã”ã¨ï¼Ÿ",
            choices: ["2å¹´", "3å¹´", "4å¹´"],
            correct: 2,
            category: "sports"
        },
        {
            question: "é‡çƒã§1ã‚¤ãƒ‹ãƒ³ã‚°ã«æŠ•æ‰‹ãŒæŠ•ã’ã‚‹æœ€å°‘çƒæ•°ã¯ï¼Ÿ",
            choices: ["3çƒ", "6çƒ", "9çƒ"],
            correct: 0,
            category: "sports"
        }
    ],
    entertainment: [
        {
            question: "ã‚¸ãƒ–ãƒªä½œå“ã€Œåƒã¨åƒå°‹ã®ç¥éš ã—ã€ã®ç›£ç£ã¯ï¼Ÿ",
            choices: ["å®®å´é§¿", "é«˜ç•‘å‹²", "ç´°ç”°å®ˆ"],
            correct: 0,
            category: "entertainment"
        },
        {
            question: "ã€Œé¬¼æ»…ã®åˆƒã€ã®ä¸»äººå…¬ã®åå‰ã¯ï¼Ÿ",
            choices: ["ç«ˆé–€ç‚­æ²»éƒ", "æˆ‘å¦»å–„é€¸", "å˜´å¹³ä¼Šä¹‹åŠ©"],
            correct: 0,
            category: "entertainment"
        },
        {
            question: "ãƒã‚±ãƒ¢ãƒ³ã®æœ€åˆã®å¾¡ä¸‰å®¶ã¯ï¼Ÿ",
            choices: ["ãƒ•ã‚·ã‚®ãƒ€ãƒãƒ»ãƒ’ãƒˆã‚«ã‚²ãƒ»ã‚¼ãƒ‹ã‚¬ãƒ¡", "ãƒã‚³ãƒªãƒ¼ã‚¿ãƒ»ãƒ’ãƒã‚¢ãƒ©ã‚·ãƒ»ãƒ¯ãƒ‹ãƒã‚³", "ã‚­ãƒ¢ãƒªãƒ»ã‚¢ãƒãƒ£ãƒ¢ãƒ»ãƒŸã‚ºã‚´ãƒ­ã‚¦"],
            correct: 0,
            category: "entertainment"
        }
    ]
};

// WebSocketæ¥ç¶šç®¡ç†ï¼ˆURLè‡ªå‹•åˆ¤å®šç‰ˆï¼‰
function initWebSocket() {
    // æœ¬ç•ªç’°å¢ƒã¨ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’è‡ªå‹•åˆ¤å®š
    const isProduction = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const host = isProduction ? window.location.host : 'localhost:10000';
    const wsUrl = `${protocol}//${host}`;
    
    console.log('WebSocketæ¥ç¶šå…ˆ:', wsUrl);
    
    try {
        gameState.onlineState.ws = new WebSocket(wsUrl);
        
        gameState.onlineState.ws.onopen = () => {
            console.log('WebSocketæ¥ç¶šæˆåŠŸ');
            updateConnectionStatus(true);
        };
        
        gameState.onlineState.ws.onclose = () => {
            console.log('WebSocketæ¥ç¶šåˆ‡æ–­');
            updateConnectionStatus(false);
        };
        
        gameState.onlineState.ws.onmessage = (event) => {
            handleWebSocketMessage(JSON.parse(event.data));
        };
        
        gameState.onlineState.ws.onerror = (error) => {
            console.error('WebSocketã‚¨ãƒ©ãƒ¼:', error);
            updateConnectionStatus(false);
        };
    } catch (error) {
        console.error('WebSocketæ¥ç¶šå¤±æ•—:', error);
        updateConnectionStatus(false);
    }
}

function handleWebSocketMessage(data) {
    console.log('å—ä¿¡:', data);
    
    switch(data.type) {
        case 'roomCreated':
            gameState.onlineState.roomId = data.roomId;
            gameState.onlineState.playerId = data.playerId;
            gameState.onlineState.isHost = true;
            document.getElementById('roomIdDisplay').textContent = `ãƒ«ãƒ¼ãƒ ID: ${data.roomId}`;
            showScreen('onlineWaitingScreen');
            updateOnlinePlayerList(data.players);
            // ãƒ›ã‚¹ãƒˆã®å ´åˆã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            document.getElementById('startOnlineGameBtn').style.display = 'block';
            break;
            
        case 'joinedRoom':
            gameState.onlineState.roomId = data.roomId;
            gameState.onlineState.playerId = data.playerId;
            gameState.onlineState.isHost = false;
            showScreen('onlineWaitingScreen');
            // ã‚²ã‚¹ãƒˆã®å ´åˆã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            document.getElementById('startOnlineGameBtn').style.display = 'none';
            break;
            
        case 'playerJoined':
        case 'playerLeft':
        case 'playerReady':
            updateOnlinePlayerList(data.players);
            // ãƒ›ã‚¹ãƒˆã®æ¨©é™ã‚’æ›´æ–°
            if (data.type === 'playerLeft' && gameState.onlineState.isHost) {
                document.getElementById('startOnlineGameBtn').style.display = 'block';
            }
            break;
            
        case 'newHost':
            // æ–°ã—ã„ãƒ›ã‚¹ãƒˆã«ãªã£ãŸå ´åˆ
            if (data.hostId === gameState.onlineState.playerId) {
                gameState.onlineState.isHost = true;
                document.getElementById('startOnlineGameBtn').style.display = 'block';
            }
            break;
            
        case 'gameStart':
            startOnlineQuiz(data.questions);
            break;
            
        case 'newQuestion':
            showOnlineQuestion(data);
            break;
            
        case 'answerResult':
            handleOnlineAnswerResult(data);
            break;
            
        case 'gameEnd':
            showOnlineResults(data.scores);
            break;
            
        case 'error':
            alert(data.message);
            break;
    }
}

// ãƒ«ãƒ¼ãƒ ä½œæˆ
function createOnlineRoom() {
    const playerName = document.getElementById('onlinePlayerName').value.trim();
    if (!playerName) {
        alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    if (!gameState.onlineState.ws || gameState.onlineState.ws.readyState !== WebSocket.OPEN) {
        alert('ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“');
        return;
    }
    
    gameState.onlineState.ws.send(JSON.stringify({
        type: 'createRoom',
        playerName: playerName
    }));
}

// ãƒ«ãƒ¼ãƒ å‚åŠ 
function joinOnlineRoom() {
    const playerName = document.getElementById('onlinePlayerName').value.trim();
    const roomId = document.getElementById('roomIdInput').value.trim().toUpperCase();
    
    if (!playerName) {
        alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    if (!roomId) {
        alert('ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    if (!gameState.onlineState.ws || gameState.onlineState.ws.readyState !== WebSocket.OPEN) {
        alert('ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“');
        return;
    }
    
    gameState.onlineState.ws.send(JSON.stringify({
        type: 'joinRoom',
        playerName: playerName,
        roomId: roomId
    }));
}

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æº–å‚™çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆ
function togglePlayerReady() {
    if (!gameState.onlineState.playerId || !gameState.onlineState.ws) {
        return;
    }
    
    gameState.onlineState.ws.send(JSON.stringify({
        type: 'ready',
        playerId: gameState.onlineState.playerId
    }));
}

function sendWebSocketMessage(data) {
    if (gameState.onlineState.ws && gameState.onlineState.ws.readyState === WebSocket.OPEN) {
        gameState.onlineState.ws.send(JSON.stringify(data));
    }
}

// éŸ³å£°ã®ON/OFF
function toggleSound() {
    gameState.soundEnabled = !gameState.soundEnabled;
    document.getElementById('soundIcon').textContent = gameState.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
}

function playSound(soundName) {
    if (gameState.soundEnabled && sounds[soundName]) {
        sounds[soundName].currentTime = 0;
        sounds[soundName].play().catch(e => console.log('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:', e));
    }
}

// æ¥ç¶šçŠ¶æ…‹ã®æ›´æ–°
function updateConnectionStatus(connected) {
    const status = document.getElementById('connectionStatus');
    if (connected) {
        status.textContent = 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³';
        status.className = 'connection-status connected';
    } else {
        status.textContent = 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³';
        status.className = 'connection-status disconnected';
    }
}

// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å•é¡Œã‚’èª­ã¿è¾¼ã‚€
function loadQuestions() {
    const saved = localStorage.getItem('customQuestions');
    const customQuestions = saved ? JSON.parse(saved) : [];
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    let allQuestions = [];
    
    gameState.selectedCategories.forEach(category => {
        if (defaultQuestions[category]) {
            allQuestions = allQuestions.concat(defaultQuestions[category]);
        }
        if (category === 'custom') {
            allQuestions = allQuestions.concat(customQuestions);
        }
    });
    
    return allQuestions;
}

// ç”»é¢åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    document.getElementById(screenId).classList.add('active');
}

function showHome() {
    showScreen('homeScreen');
    resetGame();
    if (gameState.onlineState.ws) {
        gameState.onlineState.ws.close();
    }
}

function startLocalGame() {
    gameState.mode = 'local';
    showPlayerRegistration();
}

function showOnlineMenu() {
    gameState.mode = 'online';
    showScreen('onlineMenuScreen');
    document.getElementById('connectionStatus').style.display = 'block';
    initWebSocket();
}

function showJoinRoom() {
    showScreen('joinRoomScreen');
}

function showPlayerRegistration() {
    showScreen('playerScreen');
    updatePlayerList();
}

function showQuestionCreator() {
    showScreen('questionCreatorScreen');
    updateQuestionList();
}

function showCategorySelection() {
    showScreen('categoryScreen');
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠ
    gameState.selectedCategories = ['general', 'geography', 'history', 'science', 'sports', 'entertainment'];
    document.querySelectorAll('.category-item').forEach(item => {
        item.classList.add('selected');
    });
}

// ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ
function toggleCategory(category) {
    const item = document.querySelector(`[data-category="${category}"]`);
    if (gameState.selectedCategories.includes(category)) {
        gameState.selectedCategories = gameState.selectedCategories.filter(c => c !== category);
        item.classList.remove('selected');
    } else {
        gameState.selectedCategories.push(category);
        item.classList.add('selected');
    }
}

// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ ç®¡ç†
function createRoom() {
    const playerName = document.getElementById('onlinePlayerName').value.trim();
    if (!playerName) {
        alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    gameState.onlineState.playerId = Date.now().toString();
    gameState.onlineState.roomId = Math.random().toString(36).substr(2, 6).toUpperCase();
    gameState.onlineState.isHost = true;
    
    // ãƒ‡ãƒ¢ç”¨ã®ãƒ«ãƒ¼ãƒ ä½œæˆ
    document.getElementById('roomIdDisplay').textContent = `ãƒ«ãƒ¼ãƒ ID: ${gameState.onlineState.roomId}`;
    showScreen('onlineWaitingScreen');
    
    sendWebSocketMessage({
        type: 'createRoom',
        playerId: gameState.onlineState.playerId,
        playerName: playerName
    });
}

function joinRoom() {
    const playerName = document.getElementById('onlinePlayerName').value.trim();
    const roomId = document.getElementById('roomIdInput').value.trim();
    
    if (!playerName || !roomId) {
        alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã¨ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    gameState.onlineState.playerId = Date.now().toString();
    gameState.onlineState.roomId = roomId;
    
    sendWebSocketMessage({
        type: 'joinRoom',
        playerId: gameState.onlineState.playerId,
        playerName: playerName,
        roomId: roomId
    });
    
    document.getElementById('roomIdDisplay').textContent = `ãƒ«ãƒ¼ãƒ ID: ${roomId}`;
    showScreen('onlineWaitingScreen');
}

function leaveRoom() {
    sendWebSocketMessage({
        type: 'leaveRoom',
        playerId: gameState.onlineState.playerId,
        roomId: gameState.onlineState.roomId
    });
    showOnlineMenu();
}

// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆæ›´æ–°
function updateOnlinePlayerList(players) {
    const playerListDiv = document.getElementById('onlinePlayerList');
    if (!playerListDiv) return;
    
    playerListDiv.innerHTML = players.map(player => `
        <div class="player-item ${player.ready ? 'ready' : ''}">
            <span>${player.name}</span>
            <span class="ready-status">${player.ready ? 'æº–å‚™å®Œäº†' : 'å¾…æ©Ÿä¸­'}</span>
            ${player.id === gameState.onlineState.playerId ? '<span class="you-label">(ã‚ãªãŸ)</span>' : ''}
            ${player.id === gameState.onlineState.roomId ? '<span class="host-label">(ãƒ›ã‚¹ãƒˆ)</span>' : ''}
        </div>
    `).join('');
}



// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å•é¡Œè¡¨ç¤º
function showOnlineQuestion(data) {
    gameState.currentQuestion = data.questionNumber - 1;
    gameState.questions = [data.question];
    gameState.currentAnswers = [];
    
    // å•é¡Œç”»é¢ã«ç§»å‹•
    showScreen('quizScreen');
    
    // å•é¡Œè¡¨ç¤º
    document.getElementById('questionText').textContent = data.question.question;
    document.getElementById('questionNumber').textContent = `å•é¡Œ ${data.questionNumber} / ${data.totalQuestions}`;
    
    // é¸æŠè‚¢è¡¨ç¤º
    const choicesDiv = document.getElementById('choices');
    choicesDiv.innerHTML = data.question.choices.map((choice, index) => `
        <button class="choice" onclick="selectOnlineChoice(${index})">${choice}</button>
    `).join('');
    
    // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
    gameState.timeLeft = 15;
    startTimer();
    
    // å›ç­”ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
    document.getElementById('answerList').innerHTML = '';
}

// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³é¸æŠè‚¢é¸æŠ
function selectOnlineChoice(index) {
    // æ—¢ã«å›ç­”æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
    if (gameState.currentAnswers.some(answer => answer.player === 'ã‚ãªãŸ')) {
        return;
    }
    
    // é¸æŠè‚¢ã‚’ç„¡åŠ¹åŒ–
    const choices = document.querySelectorAll('.choice');
    choices.forEach(choice => choice.disabled = true);
    choices[index].classList.add('selected');
    
    // ã‚µãƒ¼ãƒãƒ¼ã«å›ç­”é€ä¿¡
    gameState.onlineState.ws.send(JSON.stringify({
        type: 'selectAnswer',
        roomId: gameState.onlineState.roomId,
        playerId: gameState.onlineState.playerId,
        answerIndex: index
    }));
}

// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å›ç­”çµæœå‡¦ç†
function handleOnlineAnswerResult(data) {
    const answerData = {
        player: data.playerName === getCurrentPlayerName() ? 'ã‚ãªãŸ' : data.playerName,
        answer: data.answerIndex,
        correct: data.correct,
        timeLeft: gameState.timeLeft,
        order: data.currentAnswers.filter(a => a.correct).length
    };
    
    gameState.currentAnswers.push(answerData);
    
    // é¸æŠè‚¢ã®è‰²ã‚’æ›´æ–°
    const choices = document.querySelectorAll('.choice');
    if (data.correct) {
        choices[data.answerIndex].classList.add('correct');
        playSound('correct');
    } else {
        choices[data.answerIndex].classList.add('incorrect');
        playSound('incorrect');
    }
    
    updateAnswerLog();
}

// ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å–å¾—
function getCurrentPlayerName() {
    return document.getElementById('onlinePlayerName').value.trim();
}

// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒ é–‹å§‹
function startOnlineGame() {
    if (!gameState.onlineState.isHost) {
        alert('ãƒ›ã‚¹ãƒˆã®ã¿ãŒã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã¾ã™');
        return;
    }
    
    if (!gameState.onlineState.roomId || !gameState.onlineState.playerId) {
        alert('ãƒ«ãƒ¼ãƒ æƒ…å ±ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
        return;
    }
    
    console.log('ã‚²ãƒ¼ãƒ é–‹å§‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡:', {
        roomId: gameState.onlineState.roomId,
        playerId: gameState.onlineState.playerId,
        isHost: gameState.onlineState.isHost
    });
    
    gameState.onlineState.ws.send(JSON.stringify({
        type: 'startGame',
        roomId: gameState.onlineState.roomId,
        playerId: gameState.onlineState.playerId
    }));
}

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
function addPlayer() {
    const input = document.getElementById('playerName');
    const name = input.value.trim();
    
    if (name && !gameState.players.includes(name)) {
        gameState.players.push(name);
        gameState.scores[name] = 0;
        
        input.value = '';
        updatePlayerList();
        
        if (gameState.players.length >= 2) {
            document.getElementById('startBtn').style.display = 'inline-block';
        }
    }
}

function updatePlayerList() {
    const list = document.getElementById('playerList');
    list.innerHTML = gameState.players.map((player, index) => `
        <div class="player-item">
            <span>${player}</span>
            <button class="btn btn-danger" onclick="removePlayer(${index})">å‰Šé™¤</button>
        </div>
    `).join('');
}

function removePlayer(index) {
    const player = gameState.players[index];
    gameState.players.splice(index, 1);
    delete gameState.scores[player];
    updatePlayerList();
    
    if (gameState.players.length < 2) {
        document.getElementById('startBtn').style.display = 'none';
    }
}

// ã‚²ãƒ¼ãƒ é–‹å§‹
function startGameWithCategories() {
    if (gameState.selectedCategories.length === 0) {
        alert('å°‘ãªãã¨ã‚‚1ã¤ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
    }
    
    gameState.questions = loadQuestions();
    
    if (gameState.questions.length < 6) {
        alert('å•é¡ŒãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ä»–ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚‚é¸æŠã—ã¦ãã ã•ã„');
        return;
    }
    
    // 6å•ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
    gameState.questions = shuffleArray(gameState.questions).slice(0, 6);
    gameState.currentQuestion = 0;
    
    showScreen('quizScreen');
    showQuestion();
    playSound('start');
}

// å•é¡Œè¡¨ç¤º
function showQuestion() {
    if (gameState.currentQuestion >= 6) {
        showResults();
        return;
    }
    
    const q = gameState.questions[gameState.currentQuestion];
    document.getElementById('questionNumber').textContent = `ç¬¬${gameState.currentQuestion + 1}å• / 6å•`;
    document.getElementById('questionText').textContent = q.question;
    
    const choicesDiv = document.getElementById('choices');
    choicesDiv.innerHTML = q.choices.map((choice, index) => `
        <div class="choice" onclick="selectChoice(${index})">${choice}</div>
    `).join('');
    
    // å›ç­”ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
    gameState.currentAnswers = [];
    updateAnswerLog();
    
    startTimer();
}

// ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†
function startTimer() {
    gameState.timeLeft = 15;
    updateTimerDisplay();
    
    gameState.timer = setInterval(() => {
        gameState.timeLeft--;
        updateTimerDisplay();
        
        if (gameState.timeLeft <= 0) {
            clearInterval(gameState.timer);
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }
    }, 1000);
}

function updateTimerDisplay() {
    document.getElementById('timer').textContent = gameState.timeLeft;
}

// ã‚ˆã‚Šè‰¯ã„UXã®ãŸã‚ã®æ”¹è‰¯ç‰ˆé¸æŠè‚¢é¸æŠï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åå…¥åŠ›ã‚’ä¸è¦ã«ã™ã‚‹ï¼‰
function selectChoiceImproved(index) {
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
    if (gameState.players.length === 1) {
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ1äººã®å ´åˆã¯è‡ªå‹•é¸æŠ
        processAnswer(gameState.players[0], index);
    } else {
        // è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å ´åˆã¯é¸æŠè‚¢ã‚’è¡¨ç¤º
        showPlayerSelectionDialog(index);
    }
}

function showPlayerSelectionDialog(choiceIndex) {
    // æœªå›ç­”ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿ã‚’è¡¨ç¤º
    const availablePlayers = gameState.players.filter(player => 
        !gameState.currentAnswers.some(answer => answer.player === player)
    );
    
    if (availablePlayers.length === 0) {
        alert('å…¨å“¡ãŒå›ç­”æ¸ˆã¿ã§ã™');
        return;
    }
    
    const playerList = availablePlayers.map(player => 
        `<button class="btn" onclick="processAnswer('${player}', ${choiceIndex}); closePlayerDialog()">${player}</button>`
    ).join('');
    
    const dialog = document.createElement('div');
    dialog.id = 'playerDialog';
    dialog.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
   `;
   
   dialog.innerHTML = `
       <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 400px;">
           <h3 style="color: #764ba2; margin-bottom: 20px;">ã©ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå›ç­”ã—ã¾ã™ã‹ï¼Ÿ</h3>
           ${playerList}
           <button class="btn btn-danger" onclick="closePlayerDialog()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
       </div>
   `;
   
   document.body.appendChild(dialog);
}

function closePlayerDialog() {
   const dialog = document.getElementById('playerDialog');
   if (dialog) {
       dialog.remove();
   }
}

function processAnswer(playerName, choiceIndex) {
   // æ—¢ã«å›ç­”æ¸ˆã¿ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ãƒã‚§ãƒƒã‚¯
   if (gameState.currentAnswers.some(answer => answer.player === playerName)) {
       alert('æ—¢ã«å›ç­”æ¸ˆã¿ã§ã™');
       return;
   }
   
   const q = gameState.questions[gameState.currentQuestion];
   const isCorrect = choiceIndex === q.correct;
   
   // å›ç­”ã‚’è¨˜éŒ²
   const answerData = {
       player: playerName,
       answer: choiceIndex,
       correct: isCorrect,
       timeLeft: gameState.timeLeft,
       order: gameState.currentAnswers.length + 1
   };
   
   gameState.currentAnswers.push(answerData);
   
   // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ï¼ˆæ­£è§£è€…ã®ã¿ï¼‰
   if (isCorrect) {
       let points = getPointsByOrder(answerData.order);
       gameState.scores[playerName] += points;
       playSound('correct');
   } else {
       playSound('incorrect');
   }
   
   // é¸æŠè‚¢ã®è‰²ã‚’æ›´æ–°
   const choices = document.querySelectorAll('.choice');
   if (isCorrect) {
       choices[choiceIndex].classList.add('correct');
   } else {
       choices[choiceIndex].classList.add('incorrect');
       choices[q.correct].classList.add('correct');
   }
   
   updateAnswerLog();
   
   // å…¨å“¡ãŒå›ç­”ã—ãŸã‹ã€ã¾ãŸã¯æ™‚é–“åˆ‡ã‚Œã®å ´åˆã¯æ¬¡ã®å•é¡Œã¸
   if (gameState.currentAnswers.length >= gameState.players.length) {
       clearInterval(gameState.timer);
       setTimeout(() => {
           nextQuestion();
       }, 2000);
   }
}

// é¸æŠè‚¢ã‚¯ãƒªãƒƒã‚¯ã‚’æ”¹è‰¯ç‰ˆã«ç½®ãæ›ãˆ
function selectChoice(index) {
   selectChoiceImproved(index);
}

// å›ç­”ãƒ­ã‚°ã®æ›´æ–°
function updateAnswerLog() {
   const answerList = document.getElementById('answerList');
   answerList.innerHTML = gameState.currentAnswers.map(answer => `
       <div class="answer-item ${answer.correct ? 'correct' : 'incorrect'}">
           <div>
               <span class="answer-order">${answer.order}ä½</span>
               <span>${answer.player}</span>
           </div>
           <div>
               <span class="answer-points">${answer.correct ? getPointsByOrder(answer.order) : 0}pt</span>
           </div>
       </div>
   `).join('');
}

function getPointsByOrder(order) {
   switch(order) {
       case 1: return 100;
       case 2: return 80;
       case 3: return 60;
       default: return 40;
   }
}

// æ¬¡ã®å•é¡Œã¸
function nextQuestion() {
   gameState.currentQuestion++;
   showQuestion();
}

// çµæœè¡¨ç¤º
function showResults() {
   clearInterval(gameState.timer);
   showScreen('resultScreen');
   
   // ã‚¹ã‚³ã‚¢ã§ã‚½ãƒ¼ãƒˆ
   const sorted = Object.entries(gameState.scores).sort((a, b) => b[1] - a[1]);
   
   const resultsDiv = document.getElementById('results');
   resultsDiv.innerHTML = sorted.map(([player, score], index) => `
       <div class="rank-item rank-${Math.min(index + 1, 3)}">
           <div>
               <span class="rank-number">${index + 1}ä½</span>
               <span>${player}</span>
           </div>
           <div>${score}ãƒã‚¤ãƒ³ãƒˆ</div>
       </div>
   `).join('');
}

// ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
function resetGame() {
   gameState = {
       mode: 'local',
       players: [],
       currentQuestion: 0,
       questions: [],
       timer: null,
       timeLeft: 15,
       scores: {},
       selectedCategories: [],
       soundEnabled: gameState.soundEnabled,
       currentAnswers: [],
       onlineState: {
           roomId: null,
           playerId: null,
           isHost: false,
           ws: gameState.onlineState.ws
       }
   };
   document.getElementById('playerName').value = '';
   document.getElementById('startBtn').style.display = 'none';
   document.getElementById('connectionStatus').style.display = 'none';
}

// å•é¡Œä½œæˆæ©Ÿèƒ½
function addQuestion() {
   const category = document.getElementById('questionCategory').value;
   const question = document.getElementById('newQuestion').value.trim();
   const choice1 = document.getElementById('choice1').value.trim();
   const choice2 = document.getElementById('choice2').value.trim();
   const choice3 = document.getElementById('choice3').value.trim();
   const correct = parseInt(document.getElementById('correctAnswer').value) - 1;
   
   if (!question || !choice1 || !choice2 || !choice3 || isNaN(correct) || correct < 0 || correct > 2) {
       alert('ã™ã¹ã¦ã®é …ç›®ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„');
       return;
   }
   
   const newQuestion = {
       question: question,
       choices: [choice1, choice2, choice3],
       correct: correct,
       category: category
   };
   
   // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
   const saved = localStorage.getItem('customQuestions');
   const customQuestions = saved ? JSON.parse(saved) : [];
   customQuestions.push(newQuestion);
   localStorage.setItem('customQuestions', JSON.stringify(customQuestions));
   
   // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
   document.getElementById('newQuestion').value = '';
   document.getElementById('choice1').value = '';
   document.getElementById('choice2').value = '';
   document.getElementById('choice3').value = '';
   document.getElementById('correctAnswer').value = '';
   
   updateQuestionList();
   alert('å•é¡Œã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');
}

function updateQuestionList() {
   const saved = localStorage.getItem('customQuestions');
   const customQuestions = saved ? JSON.parse(saved) : [];
   
   const list = document.getElementById('questionList');
   list.innerHTML = customQuestions.map((q, index) => `
       <div class="question-item">
           <strong>å•é¡Œ${index + 1}:</strong> ${q.question}<br>
           <small>ã‚«ãƒ†ã‚´ãƒªãƒ¼: ${getCategoryName(q.category)}</small><br>
           <small>é¸æŠè‚¢: ${q.choices.join(', ')}</small><br>
           <small>æ­£è§£: ${q.choices[q.correct]}</small>
           <button class="btn btn-danger" onclick="deleteQuestion(${index})">å‰Šé™¤</button>
       </div>
   `).join('');
}

function getCategoryName(category) {
   const names = {
       general: 'ä¸€èˆ¬å¸¸è­˜',
       geography: 'åœ°ç†',
       history: 'æ­´å²',
       science: 'ç§‘å­¦',
       sports: 'ã‚¹ãƒãƒ¼ãƒ„',
       entertainment: 'ã‚¨ãƒ³ã‚¿ãƒ¡',
       custom: 'ã‚«ã‚¹ã‚¿ãƒ '
   };
   return names[category] || category;
}

function deleteQuestion(index) {
   const saved = localStorage.getItem('customQuestions');
   const customQuestions = saved ? JSON.parse(saved) : [];
   customQuestions.splice(index, 1);
   localStorage.setItem('customQuestions', JSON.stringify(customQuestions));
   updateQuestionList();
}

// é…åˆ—ã‚·ãƒ£ãƒƒãƒ•ãƒ«
function shuffleArray(array) {
   const newArray = [...array];
   for (let i = newArray.length - 1; i > 0; i--) {
       const j = Math.floor(Math.random() * (i + 1));
       [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
   }
   return newArray;
}

// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ç”¨ã®è¿½åŠ é–¢æ•°
function handleOnlineAnswer(playerId, playerName, answer, correct, timeLeft) {
   const answerData = {
       player: playerName,
       answer: answer,
       correct: correct,
       timeLeft: timeLeft,
       order: gameState.currentAnswers.length + 1
   };
   
   gameState.currentAnswers.push(answerData);
   
   // é¸æŠè‚¢ã®è‰²ã‚’æ›´æ–°
   const choices = document.querySelectorAll('.choice');
   if (correct) {
       choices[answer].classList.add('correct');
       playSound('correct');
   } else {
       choices[answer].classList.add('incorrect');
       const q = gameState.questions[gameState.currentQuestion];
       choices[q.correct].classList.add('correct');
       playSound('incorrect');
   }
   
   updateAnswerLog();
}

// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¯ã‚¤ã‚ºé–‹å§‹
function startOnlineQuiz(questions) {
    gameState.questions = questions;
    gameState.currentQuestion = 0;
    gameState.mode = 'online';
    
    // ã‚¹ã‚³ã‚¢åˆæœŸåŒ–ã¯ä¸è¦ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§ç®¡ç†ï¼‰
    playSound('start');
}

// ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çµæœè¡¨ç¤º
function showOnlineResults(scores) {
    clearInterval(gameState.timer);
    showScreen('resultScreen');
    
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = scores.map((player, index) => `
        <div class="rank-item rank-${Math.min(index + 1, 3)}">
            <div>
                <span class="rank-number">${index + 1}ä½</span>
                <span>${player.playerName}${player.playerId === gameState.onlineState.playerId ? ' (ã‚ãªãŸ)' : ''}</span>
            </div>
            <div>${player.score}ãƒã‚¤ãƒ³ãƒˆ</div>
        </div>
    `).join('');
}

// ãƒ«ãƒ¼ãƒ é€€å‡º
function leaveOnlineRoom() {
    if (gameState.onlineState.playerId && gameState.onlineState.ws) {
        gameState.onlineState.ws.send(JSON.stringify({
            type: 'leaveRoom',
            playerId: gameState.onlineState.playerId
        }));
    }
    
    // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
    gameState.onlineState.roomId = null;
    gameState.onlineState.playerId = null;
    gameState.onlineState.isHost = false;
    
    showScreen('onlineMenuScreen');
}

// åˆæœŸåŒ–
window.onload = () => {
   // éŸ³å£°ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰
   Object.values(sounds).forEach(audio => {
       audio.load();
   });
   
   // ãƒ‡ãƒãƒƒã‚°ç”¨ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°
   console.log('æ—©æŠ¼ã—ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ åˆæœŸåŒ–å®Œäº†');
   console.log('ã‚²ãƒ¼ãƒ ã®ç‰¹å¾´:');
   console.log('- æ­£è§£è€…å…¨å“¡ã«ãƒã‚¤ãƒ³ãƒˆä»˜ä¸');
   console.log('- æ—©ã„é †ã«ã‚ˆã‚Šå¤šãã®ãƒã‚¤ãƒ³ãƒˆï¼ˆ1ä½:100pt, 2ä½:80pt, 3ä½:60pt, 4ä½ä»¥é™:40ptï¼‰');
   console.log('- ã¿ã‚“ãªãŒæ­£è§£ã®ãƒãƒ£ãƒ³ã‚¹ã‚ã‚Š');
};
    </script>
</body>
</html>
